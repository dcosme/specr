<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Including random effects • specr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Including random effects">
<meta property="og:description" content="specr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">specr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/specr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/custom-plot.html">Customizing plots</a>
    </li>
    <li>
      <a href="../articles/decompose_var.html">Identifying variance components</a>
    </li>
    <li>
      <a href="../articles/invest-spec.html">Investigating specific specifications</a>
    </li>
    <li>
      <a href="../articles/measurement_models.html">Including latent measurement models</a>
    </li>
    <li>
      <a href="../articles/progress.html">Visualizing progress</a>
    </li>
    <li>
      <a href="../articles/random_effects.html">Including random effects</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/masurp/specr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="random_effects_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Including random effects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/masurp/specr/blob/master/vignettes/random_effects.Rmd"><code>vignettes/random_effects.Rmd</code></a></small>
      <div class="hidden name"><code>random_effects.Rmd</code></div>

    </div>

    
    
<p>Many data are hierarchical and we want to acknowledge the nested structure in our models. Specr can easily estimate such multilevel models. We again have to write a customized function and <code><a href="../reference/run_specs.html">run_specs()</a></code> will do the rest.</p>
<p>For this example, we will us the <code>gapminder</code> data set that is included in the <code>gapminder</code>-package. We quickly recode some variable to get more interpretable estiamtes</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://masurp.github.io/specr/">specr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span>

<span class="co"># Recode some variables</span>
<span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdpPercap_log <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span>,
         pop <span class="op">=</span> <span class="va">pop</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>

<span class="co"># Check data</span>
<span class="va">gapminder</span>
<span class="co">#&gt; # A tibble: 1,704 x 7</span>
<span class="co">#&gt;    country     continent  year lifeExp    pop gdpPercap gdpPercap_log</span>
<span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425.      779.          6.66</span>
<span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9241.      821.          6.71</span>
<span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267.      853.          6.75</span>
<span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11538.      836.          6.73</span>
<span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079.      740.          6.61</span>
<span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880.      786.          6.67</span>
<span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12882.      978.          6.89</span>
<span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13868.      852.          6.75</span>
<span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16318.      649.          6.48</span>
<span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227.      635.          6.45</span>
<span class="co">#&gt; # … with 1,694 more rows</span></pre></div>
<div id="defining-a-customatized-multilevel-function" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-a-customatized-multilevel-function" class="anchor"></a>1. Defining a customatized multilevel function</h2>
<p>For this example, we use the package <code>lme4</code> and more specifically the function <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer()</a></code> to estimate the multilevel model (more complex models such as poisson or negative binomial multilevel models can likewise be estimated).</p>
<p>Based on the data set, we want to estimate the relationship between <code>gdpPercap</code> (GDP per capita) and <code>lifeExp</code> (life expectancy). Both variables are nested within both countries and years. We create several customized lmer-functions that account for different nesting strucrures.</p>
<p>Several aspects are important to take into account: - You need to load <code>lavaan</code> within the function to be able to use <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer()</a></code> - You need to load <code>broom.mixed</code> as the standard <code><a href="https://rdrr.io/pkg/generics/man/tidy.html">broom::tidy</a></code> function does not work for merMod-objects.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="co"># Random intercept model (only country as grouping variable)</span>
<span class="va">lmer_ri_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span>
  <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">"+ (1|country)"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Including random slopes (only country as grouping variable)</span>
<span class="va">lmer_rs_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span>
  <span class="va">slopevars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">" ~ "</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
  <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">"+ (1 + "</span>, <span class="va">slopevars</span>, <span class="st">"|country)"</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Random intercept model (lifeExp is nested in both countries and years)</span>
<span class="va">lmer_ri_2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span>
  <span class="va">slopevars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">" ~ "</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
  <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">"+ (1|country) + (1|year)"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Including random slopes (intercept and slopes are nested in both countries and years)</span>
<span class="va">lmer_rs_2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span>
  <span class="va">slopevars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">" ~ "</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
  <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">"+ (1 + "</span>, <span class="va">slopevars</span>, <span class="st">"|country) + ("</span>, <span class="va">slopevars</span>, <span class="st">"|year)"</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span><span class="op">)</span>
<span class="op">}</span></pre></div>
</div>
<div id="estimate-the-models" class="section level2">
<h2 class="hasAnchor">
<a href="#estimate-the-models" class="anchor"></a>2. Estimate the models</h2>
<p>We can now use these function to estimate these models. In this example, we investigate the influence of differnet nesting structure on the fixed effect between GDP per capita and life expectancy.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="op">(</span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_specs.html">run_specs</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">gapminder</span>,
                      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lifeExp"</span><span class="op">)</span>,
                      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gdpPercap_log"</span><span class="op">)</span>, 
                      model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lmer_ri_1"</span>, <span class="st">"lmer_ri_2"</span>, 
                                <span class="st">"lmer_rs_1"</span>, <span class="st">"lmer_rs_2"</span><span class="op">)</span>,
                      controls <span class="op">=</span> <span class="st">"pop"</span>,
                      keep.results <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 12 x 19</span>
<span class="co">#&gt;    x     y     model controls res   effect group estimate std.error statistic</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;lis&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 gdpP… life… lmer… pop      &lt;lme… fixed  &lt;NA&gt;      9.00     0.241     37.3 </span>
<span class="co">#&gt;  2 gdpP… life… lmer… pop      &lt;lme… fixed  &lt;NA&gt;      2.34     0.247      9.48</span>
<span class="co">#&gt;  3 gdpP… life… lmer… pop      &lt;lme… fixed  &lt;NA&gt;      6.07     0.396     15.3 </span>
<span class="co">#&gt;  4 gdpP… life… lmer… pop      &lt;lme… fixed  &lt;NA&gt;      3.15     0.646      4.88</span>
<span class="co">#&gt;  5 gdpP… life… lmer… pop      &lt;lme… fixed  &lt;NA&gt;      9.00     0.241     37.3 </span>
<span class="co">#&gt;  6 gdpP… life… lmer… pop      &lt;lme… fixed  &lt;NA&gt;      2.34     0.247      9.48</span>
<span class="co">#&gt;  7 gdpP… life… lmer… pop      &lt;lme… fixed  &lt;NA&gt;      6.07     0.396     15.3 </span>
<span class="co">#&gt;  8 gdpP… life… lmer… pop      &lt;lme… fixed  &lt;NA&gt;      3.15     0.646      4.88</span>
<span class="co">#&gt;  9 gdpP… life… lmer… no cova… &lt;lme… fixed  &lt;NA&gt;      9.25     0.242     38.2 </span>
<span class="co">#&gt; 10 gdpP… life… lmer… no cova… &lt;lme… fixed  &lt;NA&gt;      2.53     0.247     10.2 </span>
<span class="co">#&gt; 11 gdpP… life… lmer… no cova… &lt;lme… fixed  &lt;NA&gt;     11.3      0.855     13.2 </span>
<span class="co">#&gt; 12 gdpP… life… lmer… no cova… &lt;lme… fixed  &lt;NA&gt;      2.38     0.588      4.05</span>
<span class="co">#&gt; # … with 9 more variables: conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;, fit_sigma &lt;dbl&gt;,</span>
<span class="co">#&gt; #   fit_logLik &lt;dbl&gt;, fit_AIC &lt;dbl&gt;, fit_BIC &lt;dbl&gt;, fit_REMLcrit &lt;dbl&gt;,</span>
<span class="co">#&gt; #   fit_df.residual &lt;int&gt;, subsets &lt;chr&gt;</span></pre></div>
<p>Like always, we can now inspect the results and plot the specification curve. Unfortunately, the <code><a href="https://rdrr.io/pkg/generics/man/glance.html">broom.mixed::glance()</a></code> does not extract the number of observations automatically. If we want to use the <code><a href="../reference/summarise_specs.html">summarise_specs()</a></code>-function, we thus quickly need to add the observations manually.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># Inspect results</span>
<span class="va">results</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fit_nobs <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">nobs</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/summarise_specs.html">summarise_specs</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">model</span>, <span class="va">subsets</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 x 10</span>
<span class="co">#&gt; # Groups:   y, model [4]</span>
<span class="co">#&gt;   y       model     subsets median   mad   min   max   q25   q75   obs</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 lifeExp lmer_ri_1 all       9.00     0  9.00  9.25  9.00  9.13  1704</span>
<span class="co">#&gt; 2 lifeExp lmer_ri_2 all       2.34     0  2.34  2.53  2.34  2.43  1704</span>
<span class="co">#&gt; 3 lifeExp lmer_rs_1 all       6.07     0  6.07 11.3   6.07  8.69  1704</span>
<span class="co">#&gt; 4 lifeExp lmer_rs_2 all       3.15     0  2.38  3.15  2.77  3.15  1704</span>

<span class="co"># Plot</span>
<span class="fu"><a href="../reference/plot_specs.html">plot_specs</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></pre></div>
<p><img src="random_effects_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
</div>
<div id="more-specific-analyses" class="section level2">
<h2 class="hasAnchor">
<a href="#more-specific-analyses" class="anchor"></a>3. More specific analyses</h2>
<p>Bear in mind that <code><a href="../reference/run_specs.html">run_specs()</a></code> has created entire merMod objects. As we have kept these objects (by <code>keep.results = T</code>), we can retrieve them by looking at the column “res” and e.g., produce the standard summary of lme4.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># First model</span>
<span class="va">results</span><span class="op">$</span><span class="va">res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> 
  <span class="va">summary</span>
<span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span>
<span class="co">#&gt; Formula: lifeExp ~ gdpPercap_log + pop + (1 | country)</span>
<span class="co">#&gt;    Data: data</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; REML criterion at convergence: 10855.2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scaled residuals: </span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -3.8643 -0.4921  0.0226  0.5402  3.0994 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;  Groups   Name        Variance Std.Dev.</span>
<span class="co">#&gt;  country  (Intercept) 31.17    5.583   </span>
<span class="co">#&gt;  Residual             26.98    5.194   </span>
<span class="co">#&gt; Number of obs: 1704, groups:  country, 142</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fixed effects:</span>
<span class="co">#&gt;                 Estimate Std. Error t value</span>
<span class="co">#&gt; (Intercept)   -1.470e+01  2.016e+00  -7.294</span>
<span class="co">#&gt; gdpPercap_log  9.003e+00  2.411e-01  37.345</span>
<span class="co">#&gt; pop            2.442e-05  3.117e-06   7.833</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Correlation of Fixed Effects:</span>
<span class="co">#&gt;             (Intr) gdpPr_</span>
<span class="co">#&gt; gdpPercp_lg -0.970       </span>
<span class="co">#&gt; pop          0.087 -0.136</span>
<span class="co">#&gt; fit warnings:</span>
<span class="co">#&gt; Some predictor variables are on very different scales: consider rescaling</span>

<span class="co"># Fixed effects for all models</span>
<span class="va">results</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">fixef</span><span class="op">)</span> 
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log           pop </span>
<span class="co">#&gt; -1.470391e+01  9.003243e+00  2.441721e-05 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log           pop </span>
<span class="co">#&gt;  3.997514e+01  2.337900e+00  1.435283e-05 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log           pop </span>
<span class="co">#&gt;  -0.354560951   6.066384127   0.002707258 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log           pop </span>
<span class="co">#&gt;  27.289551863   3.152184695   0.001445719 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log           pop </span>
<span class="co">#&gt; -1.470391e+01  9.003243e+00  2.441721e-05 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log           pop </span>
<span class="co">#&gt;  3.997514e+01  2.337900e+00  1.435283e-05 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[7]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log           pop </span>
<span class="co">#&gt;  -0.354560951   6.066384127   0.002707258 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[8]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log           pop </span>
<span class="co">#&gt;  27.289551863   3.152184695   0.001445719 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[9]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log </span>
<span class="co">#&gt;    -15.999649      9.250647 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[10]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log </span>
<span class="co">#&gt;     38.817615      2.531849 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[11]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log </span>
<span class="co">#&gt;     -32.05618      11.32202 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[12]]</span>
<span class="co">#&gt;   (Intercept) gdpPercap_log </span>
<span class="co">#&gt;      42.67310       2.38358</span></pre></div>
<p>To spot difference between models, we can also use the <code><a href="../reference/plot_summary.html">plot_summary()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="../reference/plot_summary.html">plot_summary</a></span><span class="op">(</span><span class="va">results</span>, choices <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span></pre></div>
<p><img src="random_effects_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>Finally, we can investigate differences in the models by comparing fit indices (e.g., AIC, BIC, deviance…).</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># Create curve plot</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_curve.html">plot_curve</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">fit_AIC</span>, ci <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">specifications</span>, y <span class="op">=</span> <span class="va">fit_AIC</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="co"># increasing size of points</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">6000</span>, <span class="fl">12000</span><span class="op">)</span>

<span class="co"># Create choice panel with chisq arrangement</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_choices.html">plot_choices</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">fit_AIC</span>, choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"controls"</span>, <span class="st">"model"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Bind together</span>
<span class="fu"><a href="../reference/plot_specs.html">plot_specs</a></span><span class="op">(</span>plot_a <span class="op">=</span> <span class="va">p1</span>,
           plot_b <span class="op">=</span> <span class="va">p2</span><span class="op">)</span></pre></div>
<p><img src="random_effects_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Philipp K. Masur, Michael Scharkow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
